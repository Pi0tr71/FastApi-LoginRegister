<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
</head>
<body>

<h1>Dashboard</h1>

<div id="userInfoContainer">
    <!-- Tutaj będą wyświetlane informacje o użytkowniku -->
</div>

<div id="editFormContainer">
    <h2>Edycja Profilu</h2>
    <form id="editProfileForm">
        <label for="editUsername">Nowa nazwa użytkownika:</label>
        <input type="text" id="editUsername" name="editUsername">

        <label for="editEmail">Nowy adres email:</label>
        <input type="email" id="editEmail" name="editEmail">

        <button type="button" onclick="updateUserProfile()">Zapisz zmiany</button>
    </form>
</div>

<script>
    // Pobranie tokena z localStorage
    var userToken = localStorage.getItem("userToken");

    // Pobranie danych użytkownika po zalogowaniu
    fetch("http://127.0.0.1:8000/profiles/username", {
        method: "GET",
        headers: {
            "Authorization": "Bearer " + userToken
        }
    })
    .then(response => response.json())
    .then(userData => {
        console.log("Dane użytkownika:", userData);

        // Wyświetlenie informacji o użytkowniku
        var userInfoContainer = document.getElementById("userInfoContainer");
        userInfoContainer.innerHTML = `
            <p>ID: ${userData.id}</p>
            <p>Nazwa użytkownika: ${userData.username}</p>
            <p>Email: ${userData.email}</p>
        `;

        // Wypełnienie formularza edycji aktualnymi danymi użytkownika
        var editUsernameInput = document.getElementById("editUsername");
        var editEmailInput = document.getElementById("editEmail");
        editUsernameInput.value = userData.username;
        editEmailInput.value = userData.email;
    })
    .catch(error => {
        console.error("Błąd podczas pobierania danych użytkownika:", error);
    });

    // Funkcja do aktualizacji danych użytkownika
    function updateUserProfile() {
        var newUsername = document.getElementById("editUsername").value;
        var newEmail = document.getElementById("editEmail").value;

        var updatedUserData = {
            "username": newUsername,
            "email": newEmail
        };

        // Wysyłanie żądania PUT do API
        fetch("http://127.0.0.1:8000/profiles/username", {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer " + userToken
            },
            body: JSON.stringify(updatedUserData)
        })
        .then(response => response.json())
        .then(updatedData => {
            console.log("Dane użytkownika po aktualizacji:", updatedData);

            // Aktualizacja informacji o użytkowniku
            var userInfoContainer = document.getElementById("userInfoContainer");
            userInfoContainer.innerHTML = `
                <p>ID: ${updatedData.id}</p>
                <p>Nazwa użytkownika: ${updatedData.username}</p>
                <p>Email: ${updatedData.email}</p>
            `;

            // Wyczyszczenie formularza po zaktualizowaniu danych
            var editUsernameInput = document.getElementById("editUsername");
            var editEmailInput = document.getElementById("editEmail");
            editUsernameInput.value = "";
            editEmailInput.value = "";
        })
        .catch(error => {
            console.error("Błąd podczas aktualizacji danych użytkownika:", error);
        });
    }
</script>

</body>
</html>
